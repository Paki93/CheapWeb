<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Booking | CheapWeb</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- Navigation -->
    <nav>
      <div class="container nav-container">
        <h1 class="logo">
          <a href="index.html">CheapWeb</a>
        </h1>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="payment.html">Packages</a></li>
          <li><a href="feedback.html" class="active">Feedback</a></li>
        </ul>
      </div>
    </nav>

    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #f8f9fa;
        margin: 0;
        color: #202124;
      }

      header {
        background: #122c53;
        color: #fff;
        text-align: center;
        padding: 20px;
      }

      main {
        max-width: 700px;
        margin: 30px auto;
        padding: 0 15px;
      }

      .review-form {
        background: #fff;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 35px;
      }

      input,
      textarea {
        width: 100%;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 12px;
        font-size: 1rem;
        font-family: inherit;
      }

      textarea {
        min-height: 70px;
        resize: vertical;
      }

      .stars {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .star {
        font-size: 2rem;
        color: #ccc;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .star:hover {
        transform: scale(1.2);
      }

      .star.active {
        color: gold;
      }

      .save-btn {
        width: 100%;
        background: #122c53;
        color: white;
        border: none;
        padding: 12px;
        font-size: 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
      }

      .save-btn:hover {
        background: #1f4588;
      }

      .average-rating {
        text-align: center;
        margin-bottom: 25px;
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .average-stars {
        font-size: 1.6rem;
        color: gold;
        letter-spacing: 3px;
      }

      #displayBox {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .entry-box {
        background: white;
        border-radius: 12px;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        padding: 15px;
      }

      .entry-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .entry-header strong {
        font-size: 1rem;
      }

      .entry-header span {
        color: gold;
        font-size: 1rem;
      }

      @media (max-width: 600px) {
        .star {
          font-size: 1.8rem;
        }
      }
    </style>

    <main>
      <div class="average-rating">
        <div id="avgStars" class="average-stars">â˜†â˜†â˜†â˜†â˜†</div>
        <h3 id="avgText">Average Rating: 0.0 / 5</h3>
        <p id="avgCount">No reviews yet.</p>
      </div>

      <div class="review-form">
        <h2>Leave a Review</h2>
        <input type="text" id="username" placeholder="Your Name" />
        <textarea id="comment" placeholder="Write your comment..."></textarea>

        <div class="stars" id="stars">
          <span class="star" data-value="1">â˜…</span>
          <span class="star" data-value="2">â˜…</span>
          <span class="star" data-value="3">â˜…</span>
          <span class="star" data-value="4">â˜…</span>
          <span class="star" data-value="5">â˜…</span>
        </div>

        <button class="save-btn" onclick="saveEntry()">Submit Review</button>
      </div>

      <div id="displayBox"></div>
    </main>

    <footer>
      <p>&copy; 2025 CheapWeb. All rights reserved.</p>
    </footer>

    <script>
      // ðŸ”— Your Google App Script URL
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxijUIlBAnNNBTxFqu0tbe4FXHjaoM8nGFp-QcjCMAn3rUb8LCv-ZT0vGDpEI0GkE8Zeg/exec";

      let rating = 0;
      const stars = document.querySelectorAll(".star");

      // â­ Star rating selection
      stars.forEach((s) => {
        s.addEventListener("click", () => {
          rating = Number(s.dataset.value);
          updateStars();
        });
      });

      function updateStars() {
        stars.forEach((s) => {
          s.classList.toggle("active", Number(s.dataset.value) <= rating);
        });
      }

      // â­ SAVE review to Google Sheets
      async function saveEntry() {
        const name = document.getElementById("username").value.trim();
        const comment = document.getElementById("comment").value.trim();

        if (!name || !comment || rating === 0) {
          alert("Please fill in all fields and select a rating.");
          return;
        }

        const payload = { username: name, comment: comment, rating: rating };

        await fetch(SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(payload),
        });

        alert("Thanks for your feedback!");

        document.getElementById("username").value = "";
        document.getElementById("comment").value = "";
        rating = 0;
        updateStars();

        fetchReviews();
      }

      // â­ LOAD reviews from Google Sheets
      async function fetchReviews() {
        const displayBox = document.getElementById("displayBox");
        displayBox.innerHTML = "<p>Loading reviews...</p>";

        try {
          const res = await fetch(SCRIPT_URL);
          const reviews = await res.json();

          if (!reviews.length) {
            displayBox.innerHTML = "<p>No reviews yet.</p>";
            return;
          }

          let totalRating = 0;
          displayBox.innerHTML = "";

          reviews.forEach((r) => {
            totalRating += r.rating;

            displayBox.innerHTML += `
              <div class="entry-box">
                <div class="entry-header">
                  <strong>${r.username}</strong>
                  <span>${"â˜…".repeat(r.rating)}${"â˜†".repeat(
              5 - r.rating
            )}</span>
                </div>
                <p>${r.comment}</p>
              </div>
            `;
          });

          const avg = totalRating / reviews.length;

          document.getElementById("avgStars").innerText =
            "â˜…".repeat(Math.round(avg)) + "â˜†".repeat(5 - Math.round(avg));

          document.getElementById(
            "avgText"
          ).innerText = `Average Rating: ${avg.toFixed(1)} / 5`;

          document.getElementById("avgCount").innerText = `Based on ${
            reviews.length
          } review${reviews.length > 1 ? "s" : ""}.`;
        } catch (e) {
          displayBox.innerHTML = "<p>Error loading reviews.</p>";
        }
      }

      // Auto-run on page load
      fetchReviews();
    </script>
  </body>
</html>
